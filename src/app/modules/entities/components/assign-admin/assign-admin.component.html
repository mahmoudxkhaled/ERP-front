<div class="card">
    <h2>Assign Admin</h2>
    <p class="text-600 mb-4">Entity: <strong>{{ entityName }}</strong></p>

    <!-- Filter Options -->
    <p-panel header="Filter Options" class="mb-4">
        <div class="flex gap-4 align-items-center">
            <div class="flex align-items-center gap-2">
                <label for="includeSubentities" class="text-600">Include Sub-entities:</label>
                <p-inputSwitch id="includeSubentities" [(ngModel)]="includeSubentities"
                    (onChange)="onFilterChange()" [disabled]="loadingUsers"></p-inputSwitch>
            </div>
            <div class="flex align-items-center gap-2">
                <label for="activeOnly" class="text-600">Active Only:</label>
                <p-inputSwitch id="activeOnly" [(ngModel)]="activeOnly" (onChange)="onFilterChange()"
                    [disabled]="loadingUsers"></p-inputSwitch>
            </div>
        </div>
    </p-panel>

    <form [formGroup]="form" (ngSubmit)="submit()">
        <div class="field">
            <label for="userId">Select User <span class="text-red-500">*</span></label>
            <p-dropdown id="userId" formControlName="userId" [options]="users" optionLabel="name" optionValue="id"
                placeholder="Select a user" [class.ng-invalid]="submitted && f['userId'].invalid"
                [disabled]="loading || loadingUsers">
                <ng-template let-user pTemplate="item">
                    <div class="flex align-items-center">
                        <div>
                            <div class="font-semibold">{{ user.name }}</div>
                            <div class="text-sm text-500">{{ user.email }}</div>
                        </div>
                    </div>
                </ng-template>
            </p-dropdown>
            <small class="p-error" *ngIf="submitted && f['userId'].invalid">
                Please select a user
            </small>
            <small class="text-500" *ngIf="loadingUsers">
                Loading accounts...
            </small>
            <small class="text-500" *ngIf="!loadingUsers && users.length === 0">
                No accounts available for this entity.
            </small>
        </div>

        <div class="flex justify-content-end gap-2 mt-4">
            <p-button label="Cancel" icon="pi pi-times" class="p-button-secondary" (onClick)="cancel()"
                [disabled]="loading">
            </p-button>
            <p-button label="Assign" icon="pi pi-check" type="submit" [loading]="loading" [disabled]="loading">
            </p-button>
        </div>
    </form>
</div>

<p-toast></p-toast>