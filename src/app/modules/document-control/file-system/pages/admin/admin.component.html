<div class="system-admin-view">
    <div class="system-admin-top flex flex-col gap-3">
        <a routerLink="/document-control" class="back-link">
            <i class="pi pi-arrow-left"></i>
            <span>{{ 'fileSystem.backToHome' | translate }}</span>
        </a>

        <div class="page-header">
            <h1 class="page-title">{{ 'fileSystem.systemAdmin.title' | translate }}</h1>
            <p class="page-description">{{ 'fileSystem.systemAdmin.description' | translate }}</p>
        </div>
    </div>

    <div class="kpi-section">
        <h2 class="block-title">{{ 'fileSystem.systemAdmin.overview' | translate }}</h2>
        <div class="kpi-cards">
            <div class="kpi-card kpi-licenses">
                <div class="kpi-icon"><i class="pi pi-key"></i></div>
                <div class="kpi-info">
                    <span class="kpi-value">{{ licenses.length }}</span>
                    <span class="kpi-label">{{ 'fileSystem.systemAdmin.activeLicenses' | translate }}</span>
                </div>
            </div>
            <div class="kpi-card kpi-capacity">
                <div class="kpi-icon"><i class="pi pi-chart-bar"></i></div>
                <div class="kpi-info">
                    <span class="kpi-value">{{ capacityUsedPercent }}%</span>
                    <span class="kpi-label">{{ 'fileSystem.systemAdmin.capacityUsed' | translate }}</span>
                </div>
            </div>
            <div class="kpi-card kpi-drives">
                <div class="kpi-icon"><i class="pi pi-server"></i></div>
                <div class="kpi-info">
                    <span class="kpi-value">{{ virtualDrives.length }}</span>
                    <span class="kpi-label">{{ 'fileSystem.systemAdmin.virtualDrives' | translate }}</span>
                </div>
            </div>
        </div>
    </div>

    <div class="block-section">
        <h2 class="block-title">{{ 'fileSystem.admin.licenses' | translate }}</h2>
        <div class="block-card">
            <p-table [value]="licenses" [paginator]="false"
                styleClass="p-datatable-sm p-datatable-gridlines system-admin-table" responsiveLayout="scroll">
                <ng-template pTemplate="header">
                    <tr>
                        <th>{{ 'fileSystem.admin.product' | translate }}</th>
                        <th>{{ 'fileSystem.admin.count' | translate }}</th>
                        <th>{{ 'fileSystem.admin.expiry' | translate }}</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-row>
                    <tr>
                        <td class="cell-product">{{ getProductLabel(row) }}</td>
                        <td>{{ row.count }}</td>
                        <td><span class="expiry-badge">{{ row.expiry }}</span></td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </div>

    <div class="block-section">
        <h2 class="block-title">{{ 'fileSystem.admin.capacityUsage' | translate }}</h2>
        <div class="block-card">
            <div class="capacity-block">
                <p-progressBar [value]="capacityUsedPercent" [showValue]="true"
                    styleClass="capacity-bar"></p-progressBar>
                <p class="capacity-summary">{{ capacityUsedLabel }}</p>
                <div class="capacity-detail">
                    <div class="capacity-row">
                        <span class="capacity-label">{{ 'fileSystem.systemAdmin.used' | translate }}</span>
                        <span class="capacity-value">325 GB</span>
                    </div>
                    <div class="capacity-row">
                        <span class="capacity-label">{{ 'fileSystem.systemAdmin.total' | translate }}</span>
                        <span class="capacity-value">500 GB</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="block-section">
        <h2 class="block-title">{{ 'fileSystem.admin.virtualDrives' | translate }}</h2>
        <div class="block-card">
            <div class="mb-3 flex flex-wrap gap-3 align-items-center">
                <div class="field">
                    <label class="mr-2">{{ 'fileSystem.admin.entityFilter' | translate }}</label>
                    <p-dropdown [options]="entityFilterOptions" [(ngModel)]="entityFilter" optionLabel="label"
                        optionValue="value" [style]="{ width: '140px' }"></p-dropdown>
                </div>
                <div class="field">
                    <label class="mr-2">{{ 'fileSystem.admin.licenseId' | translate }}</label>
                    <input pInputText type="number" [(ngModel)]="licenseIdFilter" [style]="{ width: '80px' }" />
                </div>
                <div class="field flex align-items-center">
                    <p-checkbox [(ngModel)]="activeOnlyFilter" [binary]="true" inputId="activeOnly"></p-checkbox>
                    <label for="activeOnly" class="ml-2">{{ 'fileSystem.admin.activeOnly' | translate }}</label>
                </div>
                <p-button [label]="'fileSystem.admin.createVirtualDrive' | translate" icon="pi pi-plus"
                    (onClick)="showCreateDriveDialog()"></p-button>
            </div>
            <p-table [value]="virtualDrives" [paginator]="false"
                styleClass="p-datatable-sm p-datatable-gridlines system-admin-table" responsiveLayout="scroll">
                <ng-template pTemplate="header">
                    <tr>
                        <th>{{ 'fileSystem.admin.driveName' | translate }}</th>
                        <th>{{ 'fileSystem.admin.size' | translate }}</th>
                        <th>{{ 'fileSystem.admin.status' | translate }}</th>
                        <th style="width: 14rem">{{ 'fileSystem.companyStorage.actions' | translate }}</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-row>
                    <tr>
                        <td class="cell-product">{{ getDriveName(row) }}</td>
                        <td><strong>{{ row.capacity }} GB</strong></td>
                        <td>
                            <p-tag
                                [value]="row.active ? ('fileSystem.entityAdminStatus.active' | translate) : ('fileSystem.admin.inactive' | translate)"
                                [severity]="row.active ? 'success' : 'secondary'"></p-tag>
                        </td>
                        <td>
                            <button pButton type="button" icon="pi pi-eye" class="p-button-text p-button-sm mr-1"
                                [pTooltip]="'fileSystem.admin.viewDetails' | translate"
                                (click)="showDriveDetailsDialog(row)"></button>
                            <button pButton type="button" icon="pi pi-pencil" class="p-button-text p-button-sm mr-1"
                                [pTooltip]="'fileSystem.admin.renameDrive' | translate"
                                (click)="showRenameDriveDialog(row)"></button>
                            <button pButton type="button" icon="pi pi-chart-bar" class="p-button-text p-button-sm mr-1"
                                [pTooltip]="'fileSystem.admin.updateCapacity' | translate"
                                (click)="showUpdateCapacityDialog(row)"></button>
                            <button pButton *ngIf="!row.active" type="button" icon="pi pi-check"
                                class="p-button-text p-button-sm p-button-success mr-1"
                                [pTooltip]="'fileSystem.admin.activateDrive' | translate"
                                (click)="onActivateDrive(row)"></button>
                            <button pButton *ngIf="row.active" type="button" icon="pi pi-times"
                                class="p-button-text p-button-sm p-button-danger"
                                [pTooltip]="'fileSystem.admin.deactivateDrive' | translate"
                                (click)="onDeactivateDrive(row)"></button>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </div>

    <div class="block-section">
        <h2 class="block-title">{{ 'fileSystem.admin.trafficMonitoring' | translate }}</h2>
        <div class="block-card">
            <p class="mb-3">{{ 'fileSystem.admin.trafficDescription' | translate }}</p>
            <div class="kpi-cards flex flex-wrap gap-3">
                <div class="kpi-card kpi-licenses">
                    <div class="kpi-icon"><i class="pi pi-upload"></i></div>
                    <div class="kpi-info">
                        <span class="kpi-value">{{ totalUploads }}</span>
                        <span class="kpi-label">{{ 'fileSystem.admin.totalUploads' | translate }}</span>
                    </div>
                </div>
                <div class="kpi-card kpi-capacity">
                    <div class="kpi-icon"><i class="pi pi-download"></i></div>
                    <div class="kpi-info">
                        <span class="kpi-value">{{ totalDownloads }}</span>
                        <span class="kpi-label">{{ 'fileSystem.admin.totalDownloads' | translate }}</span>
                    </div>
                </div>
                <div class="kpi-card kpi-drives">
                    <div class="kpi-icon"><i class="pi pi-file"></i></div>
                    <div class="kpi-info">
                        <span class="kpi-value">{{ totalFilesTraffic }}</span>
                        <span class="kpi-label">{{ 'fileSystem.admin.totalFilesTraffic' | translate }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="block-section">
        <h2 class="block-title">{{ 'fileSystem.admin.listFileSystems' | translate }}</h2>
        <div class="block-card">
            <p class="mb-3 text-500">{{ 'fileSystem.admin.createFileSystemRequiresEntityAdmin' | translate }}</p>
            <div class="mb-3">
                <label class="mr-2">{{ 'fileSystem.admin.driveName' | translate }}</label>
                <p-dropdown [options]="driveOptionsForFileSystems" [(ngModel)]="selectedDriveIdForFileSystems"
                    optionLabel="name" optionValue="id" [style]="{ width: '280px' }"
                    placeholder="{{ 'fileSystem.admin.selectDriveToManageFileSystems' | translate }}"
                    (onChange)="onDriveSelectedForFileSystems()"></p-dropdown>
            </div>
            <p-table [value]="fileSystemsInSelectedDrive" [paginator]="false"
                styleClass="p-datatable-sm p-datatable-gridlines system-admin-table" responsiveLayout="scroll">
                <ng-template pTemplate="header">
                    <tr>
                        <th>{{ 'fileSystem.entityAdmin.fileSystemName' | translate }}</th>
                        <th>{{ 'fileSystem.entityAdmin.entityName' | translate }}</th>
                        <th>{{ 'fileSystem.entityAdmin.status' | translate }}</th>
                        <th>{{ 'fileSystem.entityAdmin.usedCapacity' | translate }}</th>
                        <th style="width: 10rem">{{ 'fileSystem.companyStorage.actions' | translate }}</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-row>
                    <tr>
                        <td>{{ getFileSystemName(row) }}</td>
                        <td>{{ getFileSystemEntityName(row) }}</td>
                        <td><p-tag [value]="getFileSystemStatusLabel(row)" [severity]="row.active ? 'success' : 'secondary'"></p-tag></td>
                        <td>{{ row.usedCapacity }}</td>
                        <td>
                            <button pButton type="button" icon="pi pi-pencil" class="p-button-text p-button-sm mr-1"
                                [pTooltip]="'fileSystem.entityAdmin.editFileSystem' | translate"
                                [disabled]="!canManageFileSystems"
                                (click)="onEditFileSystem(row)"></button>
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="5" class="text-center p-4 text-500">{{ 'fileSystem.admin.selectDriveToManageFileSystems' | translate }}</td>
                    </tr>
                </ng-template>
            </p-table>
            <div class="mt-3">
                <p-button [label]="'fileSystem.entityAdmin.createFileSystem' | translate" icon="pi pi-plus"
                    [disabled]="!canManageFileSystems"
                    [pTooltip]="createFileSystemButtonTooltip"
                    (onClick)="showCreateFileSystemDialog()"></p-button>
            </div>
        </div>
    </div>
</div>

<p-dialog [header]="'fileSystem.admin.createDriveDialogTitle' | translate" [(visible)]="createDriveDialogVisible"
    [modal]="true" [style]="{ width: '400px' }" (onHide)="hideCreateDriveDialog()" [draggable]="false"
    [resizable]="false">
    <div class="p-fluid">
        <div class="field mb-3">
            <label for="newDriveName">{{ 'fileSystem.admin.driveName' | translate }}</label>
            <input pInputText id="newDriveName" [(ngModel)]="newDriveName" class="w-full mt-2" />
        </div>
        <div class="field mb-3">
            <label for="newDriveLicenseId">{{ 'fileSystem.admin.licenseId' | translate }}</label>
            <input pInputText type="number" id="newDriveLicenseId" [(ngModel)]="newDriveLicenseId"
                class="w-full mt-2" />
        </div>
        <div class="field">
            <label for="newDriveCapacity">{{ 'fileSystem.admin.capacity' | translate }}</label>
            <input pInputText type="number" id="newDriveCapacity" [(ngModel)]="newDriveCapacity" class="w-full mt-2" />
        </div>
    </div>
    <ng-template pTemplate="footer">
        <p-button [label]="'fileSystem.companyStorage.close' | translate" styleClass="p-button-secondary"
            (onClick)="hideCreateDriveDialog()"></p-button>
        <p-button [label]="'fileSystem.companyStorage.create' | translate"
            (onClick)="onCreateDriveConfirm()"></p-button>
    </ng-template>
</p-dialog>

<p-dialog [header]="'fileSystem.admin.renameDriveDialogTitle' | translate" [(visible)]="renameDriveDialogVisible"
    [modal]="true" [style]="{ width: '400px' }" (onHide)="hideRenameDriveDialog()" [draggable]="false"
    [resizable]="false">
    <div class="p-fluid">
        <div class="field">
            <label for="renameDriveName">{{ 'fileSystem.admin.newDriveName' | translate }}</label>
            <input pInputText id="renameDriveName" [(ngModel)]="renameDriveName" class="w-full mt-2" />
        </div>
    </div>
    <ng-template pTemplate="footer">
        <p-button [label]="'fileSystem.companyStorage.close' | translate" styleClass="p-button-secondary"
            (onClick)="hideRenameDriveDialog()"></p-button>
        <p-button [label]="'fileSystem.companyStorage.save' | translate" (onClick)="onRenameDriveSave()"></p-button>
    </ng-template>
</p-dialog>

<p-dialog [header]="'fileSystem.admin.updateCapacityDialogTitle' | translate" [(visible)]="updateCapacityDialogVisible"
    [modal]="true" [style]="{ width: '400px' }" (onHide)="hideUpdateCapacityDialog()" [draggable]="false"
    [resizable]="false">
    <div class="p-fluid">
        <div class="field">
            <label for="updateCapacityValue">{{ 'fileSystem.admin.newCapacity' | translate }}</label>
            <input pInputText type="number" id="updateCapacityValue" [(ngModel)]="updateCapacityValue"
                class="w-full mt-2" />
        </div>
    </div>
    <ng-template pTemplate="footer">
        <p-button [label]="'fileSystem.companyStorage.close' | translate" styleClass="p-button-secondary"
            (onClick)="hideUpdateCapacityDialog()"></p-button>
        <p-button [label]="'fileSystem.companyStorage.save' | translate" (onClick)="onUpdateCapacitySave()"></p-button>
    </ng-template>
</p-dialog>

<p-dialog [header]="'fileSystem.admin.driveDetailsTitle' | translate" [(visible)]="driveDetailsDialogVisible"
    [modal]="true" [style]="{ width: '400px' }" (onHide)="hideDriveDetailsDialog()" [draggable]="false"
    [resizable]="false">
    <div class="p-fluid" *ngIf="selectedDriveForDetails">
        <div class="field"><label>{{ 'fileSystem.admin.driveName' | translate }}</label>
            <p>{{ getDriveName(selectedDriveForDetails) }}</p>
        </div>
        <div class="field"><label>{{ 'fileSystem.admin.size' | translate }}</label>
            <p>{{ selectedDriveForDetails.capacity }} GB</p>
        </div>
        <div class="field"><label>{{ 'fileSystem.admin.status' | translate }}</label>
            <p>{{ selectedDriveForDetails.active ? ('fileSystem.entityAdminStatus.active' | translate) :
                ('fileSystem.admin.inactive' | translate) }}</p>
        </div>
    </div>
    <ng-template pTemplate="footer">
        <p-button [label]="'fileSystem.companyStorage.close' | translate"
            (onClick)="hideDriveDetailsDialog()"></p-button>
    </ng-template>
</p-dialog>
